
<% @foos = @root.children %>

<ul id="folder_entries">
  <% for folder_entry in @foos %>
    <li id='folder_entry_<%=folder_entry.id%>'><span class="handle"><%= folder_entry.content.name %></span></li>
  <% end %>

  <li><span class="handle">[drag]</span>1</li>
  <li><span class="handle">[drag]</span>2</li>
</ul>


<h2>beneath ... </h2>
<br/><br/>

<%= render(:partial => "folder_entry", :object => @root) %>

<ul id="tag-tree">
  <%= render(:partial => "folder_entry", :collection => @root.children) %>
</ul>


<% content_for :js do %>
  <% javascript_tag do %>
    function parseTree(ul){
        var tags = [];
        ul.children("li").each(function(){
            var subtree =    $(this).children("ul");
            if(subtree.size() > 0)
                tags.push([$(this).attr("id"), parseTree(subtree)]);
            else
                tags.push($(this).attr("id"));
        });
        return tags;
    }

    $(document).ready(function(){

        $("li.tree_item span").droppable({
            tolerance        : "pointer",
            hoverClass        : "tree-hover",
            drop            : function(event, ui){
                var dropped = ui.draggable;
                dropped.css({top: 0, left: 0});
                var me = $(this).parent();
                if(me == dropped)
                    return;
                var subbranch = $(me).children("ul");
                if(subbranch.size() == 0) {
                    me.find("span").after("<ul></ul>");
                    subbranch = me.find("ul");
                }
                var oldParent = dropped.parent();
                subbranch.eq(0).append(dropped);
                var oldBranches = $("li", oldParent);
                if (oldBranches.size() == 0) { $(oldParent).remove(); }
            }
        });

        $("li.tree-item").draggable({
            opacity: 0.5,
            revert: true
        });

        $("#save").click(function(){
            /*
            var tree = $.toJSON(parseTree($("#tag-tree")));
            $.post("@saveTags", {tags: tree}, function(res){
                $("#printOut").html(res);
            });
            */
            $.debug.print_r(parseTree($("#tag-tree")), "printOut", false);
        });
    });

    // shows the content form
    function toggle_content_form(id){
    content_form = document.getElementById("content-form-" + id)
//    content_form = $("#content-form-" + id)

    if (content_form.style.display == "none")
      content_form.style.display = "block"
    else
      content_form.style.display = "none"
    }
  <% end %>
<% end %>
